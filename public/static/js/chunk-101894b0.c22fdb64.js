(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-101894b0"],{"136f":function(t,e,n){"use strict";var i=n("8530"),o=n.n(i);o.a},"45a5":function(t,e,n){"use strict";var i=n("7b90"),o=n.n(i);o.a},"7b90":function(t,e,n){},8530:function(t,e,n){},"90db":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ticket",staticStyle:{"margin-bottom":"20px"}},[n("div",{staticClass:"header"},[t._v("\n    嘉鱼殡葬所服务自助缴费系统\n  ")]),t._v(" "),n("el-row",{staticStyle:{padding:"0 20px",margin:"0"},attrs:{gutter:12}},[n("el-col",{attrs:{span:14}},[""==t.list?n("div",[n("el-divider",[t._v("暂无灵堂信息")])],1):n("div",t._l(t.list,function(e,i){return n("el-col",{key:i,attrs:{span:8,shadow:"always"}},[n("el-card",[n("div",{staticClass:"card_"},[n("img",{attrs:{src:"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570819363358&di=9a5d08a6216ccc7452d8f30b6d989049&imgtype=0&src=http%3A%2F%2Fp9.pccoo.cn%2Fbbs%2F20170811%2F2017081111164336720404_640_494.jpg",alt:"",width:"160"}}),t._v(" "),n("p",[t._v(t._s(e.title))]),t._v(" "),n("p",[t._v("逝者姓名: "+t._s(e.name)+" ("+t._s(e.sex)+")")]),t._v(" "),n("el-button",{attrs:{icon:"el-icon-shopping-cart-full",type:"danger",loading:t.downloadLoading},on:{click:function(n){return t.handlePay(e)}}},[t._v("点击结算")])],1)])],1)}),1)]),t._v(" "),n("el-col",{attrs:{span:10}},[n("el-divider",{attrs:{"content-position":"left"}},[t._v("已选服务清单"),n("span",{directives:[{name:"show",rawName:"v-show",value:t.payinfo.title,expression:"payinfo.title"}]},[t._v("（"+t._s(t.payinfo.title)+"）")])]),t._v(" "),n("el-table",{ref:"tab",attrs:{"show-header":!0,data:t.sell}},[n("el-table-column",{attrs:{type:"index",width:"50"}}),t._v(" "),n("el-table-column",{attrs:{prop:"title",label:"服务名称"}}),t._v(" "),n("el-table-column",{attrs:{prop:"number",label:"数量",width:"80"}}),t._v(" "),n("el-table-column",{attrs:{prop:"price",label:"单价",width:"80"}}),t._v(" "),n("el-table-column",{attrs:{prop:"totalprice",label:"价格",width:"100"}})],1),t._v(" "),0!=t.allprice?n("div",{staticStyle:{color:"red",margin:"10px 0"}},[t._v("*请仔细核对服务清单，确认无误后请点击支付按钮并打开微信扫码支付。")]):t._e(),t._v(" "),n("div",{staticClass:"footer",staticStyle:{"text-align":"right"}},[0!=t.allprice?n("span",{staticStyle:{"font-size":"18px","margin-right":"10px"}},[t._v("合计: "),n("strong",{staticStyle:{color:"red"}},[t._v("¥ "+t._s(t.allprice)+" 元")])]):t._e(),t._v(" "),0==t.allprice?n("el-button",{attrs:{icon:"el-icon-full-screen",type:"info",plain:""}},[t._v("扫码支付")]):n("el-button",{attrs:{icon:"el-icon-full-screen",type:"danger",loading:t.payloadLoading},on:{click:function(e){return t.pay()}}},[t._v("扫码支付")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.clear()}}},[t._v("清空")])],1)],1)],1),t._v(" "),n("el-dialog",{attrs:{id:"ticket","close-on-click-modal":!1,title:"扫码支付",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[n("img",{attrs:{src:t.url,alt:"",width:"250px"}}),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("span",{staticStyle:{"font-size":"18px","margin-right":"10px"}},[t._v("请使用微信支付: "),n("strong",{staticStyle:{color:"red"}},[t._v("¥ "+t._s(t.sum_price)+" 元")])]),t._v(" "),n("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")])],1)]),t._v(" "),n("form",{staticStyle:{position:"absolute",top:"-1555px",width:"150px"},attrs:{id:"form1",action:""}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticClass:"print_container"},[t._m(0),t._v(" "),n("span",[t._v("**************************")]),t._v(" "),n("div",{staticClass:"section4"},[n("label",[t._v("基本信息")]),t._v(" "),n("br"),t._v(" "),n("label",[t._v("订单号: "+t._s(t.out_trade_no))]),n("br"),t._v(" "),n("label",[t._v("悼念厅: "+t._s(t.payinfo.title))]),t._v(" "),n("br"),t._v(" "),n("label",[t._v("逝者姓名: "+t._s(t.payinfo.name))]),t._v(" "),n("br"),t._v(" "),n("label",[t._v("逝者性别: "+t._s(t.payinfo.sex))]),t._v(" "),n("br"),t._v(" "),n("label",[t._v("逝者年龄: "+t._s(t.payinfo.age))]),t._v(" "),n("br"),t._v(" "),n("span",[t._v("**************************")]),t._v(" "),n("div",{staticClass:"total"},[n("label",{staticClass:"left"},[t._v("已支付总计:")]),t._v(" "),n("label",{staticClass:"right"},[t._v(t._s(t.sum_price)+"元")]),t._v(" "),n("br")])])])])],1)},o=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"section1"},[n("h3",[t._v("嘉鱼县殡仪馆")])])}],a=(n("c5f6"),n("ac6a"),n("a481"),n("4917"),n("b775"));function r(t){return Object(a["a"])({url:"http://byg.jiayubz.net/dp/v1/selfservice/list",method:"get",params:t})}function l(t){return Object(a["a"])({url:"http://byg.jiayubz.net/dp/v1/selfservice/setup",method:"post",data:t})}function s(t){return Object(a["a"])({url:"http://byg.jiayubz.net/dp/v1/selfservice/info",method:"get",params:t})}function c(t){return Object(a["a"])({url:"http://byg.jiayubz.net/dp/v1/selfservice/order",method:"post",data:t})}var d,u=n("4d9b"),f=n.n(u),p=null;function v(){try{var t=navigator.userAgent;if(null!=t.match(/Windows\sPhone/i))return!0;if(null!=t.match(/iPhone|iPod/i))return!0;if(null!=t.match(/Android/i))return!0;if(null!=t.match(/Edge\D?\d+/i))return!0;var e=t.match(/Trident\D?\d+/i),n=t.match(/MSIE\D?\d+/i),i=t.match(/OPR\D?\d+/i),o=t.match(/Firefox\D?\d+/i),a=t.match(/x64/i);if(null==e&&null==n&&null!==a)return!0;if(null!==o){if(o=o[0].match(/\d+/),o[0]>=41||null!==a)return!0}else if(null!==i){if(i=i[0].match(/\d+/),i[0]>=32)return!0}else if(null==e&&null==n){var r=t.match(/Chrome\D?\d+/i);if(null!==r&&(r=r[0].match(/\d+/),r[0]>=41))return!0}return!1}catch(l){return!0}}function h(t,e){var n,i="<br><font color='#FF00FF'>打印控件未安装!点击这里<a href='install_lodop32.exe' target='_self'>执行安装</a>,安装后请刷新页面或重新进入。</font>",o="<br><font color='#FF00FF'>打印控件需要升级!点击这里<a href='install_lodop32.exe' target='_self'>执行升级</a>,升级后请重新进入。</font>",a="<br><font color='#FF00FF'>打印控件未安装!点击这里<a href='install_lodop64.exe' target='_self'>执行安装</a>,安装后请刷新页面或重新进入。</font>",r="<br><font color='#FF00FF'>打印控件需要升级!点击这里<a href='install_lodop64.exe' target='_self'>执行升级</a>,升级后请重新进入。</font>",l="<br><br><font color='#FF00FF'>（注意：如曾安装过Lodop旧版附件npActiveXPLugin,请在【工具】->【附加组件】->【扩展】中先卸它）</font>",s="<br><br><font color='#FF00FF'>(如果此前正常，仅因浏览器升级或重安装而出问题，需重新执行以上安装）</font>",c="<br><font color='#FF00FF'>CLodop云打印服务(localhost本地)未安装启动!点击这里<a href='CLodop_Setup_for_Win32NT.exe' target='_self'>执行安装</a>,安装后请刷新页面。</font>",d="<br><font color='#FF00FF'>CLodop云打印服务需升级!点击这里<a href='CLodop_Setup_for_Win32NT.exe' target='_self'>执行升级</a>,升级后请刷新页面。</font>";try{var u=navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0;if(v()){try{n=getCLodop()}catch(h){}if(!n&&"complete"!==document.readyState)return void alert("C-Lodop没准备好，请稍后再试！");if(!n)return void(u?document.write(c):document.body.innerHTML=c+document.body.innerHTML);CLODOP.CVERSION<"3.0.4.3"&&(u?document.write(d):document.body.innerHTML=d+document.body.innerHTML),e&&e.parentNode&&e.parentNode.removeChild(e),t&&t.parentNode&&t.parentNode.removeChild(t)}else{var f=u&&navigator.userAgent.indexOf("x64")>=0;if(void 0!=t||void 0!=e?n=u?t:e:null==p?(n=document.createElement("object"),n.setAttribute("width",0),n.setAttribute("height",0),n.setAttribute("style","position:absolute;left:0px;top:-100px;width:0px;height:0px;"),u?n.setAttribute("classid","clsid:2105C259-1E0C-4534-8141-A753534CB4CA"):n.setAttribute("type","application/x-print-lodop"),document.documentElement.appendChild(n),p=n):n=p,null==n||"undefined"===typeof n.VERSION)return navigator.userAgent.indexOf("Chrome")>=0&&(document.body.innerHTML=s+document.body.innerHTML),navigator.userAgent.indexOf("Firefox")>=0&&(document.body.innerHTML=l+document.body.innerHTML),f?document.write(a):u?document.write(i):document.body.innerHTML=i+document.body.innerHTML,n}return n.VERSION<"6.2.2.2"?(v()||(f?document.write(r):u?document.write(o):document.body.innerHTML=o+document.body.innerHTML),n):n}catch(h){alert("getLodop出错:"+h)}}function m(t){document.getElementById("title1").innerHTML=t,_(),d.PRINT()}function _(){d=h(),d.SET_PRINT_STYLE("FontSize",14),d.SET_PRINT_STYLE("Bold",1),d.SET_PRINT_PAGESIZE(3,710,45,""),d.ADD_PRINT_HTM(0,30,0,720,document.getElementById("form1").innerHTML)}v()&&setTimeout(function(){var t=document.head||document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.src="http://localhost:8000/CLodopfuncs.js?priority=1",t.insertBefore(e,t.firstChild),e=document.createElement("script"),e.src="http://localhost:18000/CLodopfuncs.js?priority=0",t.insertBefore(e,t.firstChild)},6e4);var b={data:function(){return{sell:[],sum_price:0,id:"",payinfo:{},info:null,downloadLoading:!1,payloadLoading:!1,out_trade_no:"",allprice:0,url:"",dialogFormVisible:!1,list:null}},watch:{sell:{handler:function(t){this.changeSell()},immediate:!0}},mounted:function(){var t=this,e=this.socket=f()("http://byg.jiayubz.net:2120");e.on("connect",function(){e.emit("login",4)}),e.on("new_msg",function(e){t.getList()})},created:function(){var t=this,e=this.socket=f()("http://byg.jiayubz.net:2120");e.on("connect",function(){e.emit("login",3)}),e.on("new_msg",function(e){var n=e.replace(/&quot;/g,'"');t.info=JSON.parse(n),t.info.id=t.id,t.info.totalprice=t.allprice,t.out_trade_no=t.info.out_trade_no,t.$nextTick(function(){t.callback(),t.$message({message:"恭喜您，支付成功",type:"success"})})}),this.getList()},methods:{getList:function(){var t=this;r().then(function(e){var n=e.data;t.list=n.filter(function(t){return t.id})}).catch(function(){t.list=[]})},handleDelete:function(t){var e=this.sell.indexOf(t);this.sell.splice(e,1)},clear:function(){this.sell=[],this.allprice=0},callback:function(){var t=this;c(this.info).then(function(e){m(),t.clear(),t.getList(),t.dialogFormVisible=!1}).catch(function(t){})},pay:function(){var t=this,e={price:this.allprice};this.payloadLoading=!0,l(e).then(function(e){t.url=e.data.code,t.payloadLoading=!1,t.dialogFormVisible=!0})},changeSell:function(){var t=0;this.sell&&this.sell.forEach(function(e,n){t+=parseInt(e.totalprice)}),this.sum_price=t},handlePay:function(t){var e=this,n={id:t.id};this.id=t.id,this.payinfo=t,this.downloadLoading=!0,s(n).then(function(t){e.sell=t.data.list,e.allprice=t.data.obotuary.totalprice,e.downloadLoading=!1})},handleChange:function(t){var e=this.sell.indexOf(t);t.totalprice=t.num*t.price,e>-1?0==t.num&&this.sell.splice(e,1):(this.sell.push(t),0==t.num&&this.sell.splice(e,1))},getSummaries:function(t){var e=t.columns,n=t.data,i=0;n.forEach(function(t,e){i+=parseInt(t.totalprice)}),this.sum_price=i;var o=[];return e.forEach(function(t,e){if(0!==e){var i=n.map(function(e){return Number(e[t.property])});i.every(function(t){return isNaN(t)})?o[e]="":(o[e]=i.reduce(function(t,e){var n=Number(e);return isNaN(n)?t:t+e},0),o[3]+=" 元")}else o[e]="合计"}),o}}},g=b,y=(n("45a5"),n("136f"),n("2877")),F=Object(y["a"])(g,i,o,!1,null,"4e95aee2",null);e["default"]=F.exports}}]);